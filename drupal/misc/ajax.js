(function($){Drupal.ajax=Drupal.ajax||{};Drupal.behaviors.AJAX={attach:function(e,t){for(var n in t.ajax){if(!$("#"+n+".ajax-processed").length){var r=t.ajax[n];if(typeof r.selector=="undefined"){r.selector="#"+n}$(r.selector).each(function(){r.element=this;Drupal.ajax[n]=new Drupal.ajax(n,this,r)});$("#"+n).addClass("ajax-processed")}}$(".use-ajax:not(.ajax-processed)").addClass("ajax-processed").each(function(){var e={};e.progress={type:"throbber"};if($(this).attr("href")){e.url=$(this).attr("href");e.event="click"}var t=$(this).attr("id");Drupal.ajax[t]=new Drupal.ajax(t,this,e)});$(".use-ajax-submit:not(.ajax-processed)").addClass("ajax-processed").each(function(){var e={};e.url=$(this.form).attr("action");e.setClick=true;e.event="click";e.progress={type:"throbber"};var t=$(this).attr("id");Drupal.ajax[t]=new Drupal.ajax(t,this,e)})}};Drupal.ajax=function(e,t,n){var r={url:"system/ajax",event:"mousedown",keypress:true,selector:"#"+e,effect:"none",speed:"none",method:"replaceWith",progress:{type:"throbber",message:Drupal.t("Please wait...")},submit:{js:true}};$.extend(this,r,n);this.element=t;this.element_settings=n;this.url=n.url.replace(/\/nojs(\/|$|\?|&|#)/g,"/ajax$1");this.wrapper="#"+n.wrapper;if(this.element.form){this.form=$(this.element.form)}var i=this;i.options={url:i.url,data:i.submit,beforeSerialize:function(e,t){return i.beforeSerialize(e,t)},beforeSubmit:function(e,t,n){i.ajaxing=true;return i.beforeSubmit(e,t,n)},beforeSend:function(e,t){i.ajaxing=true;return i.beforeSend(e,t)},success:function(e,t){if(typeof e=="string"){e=$.parseJSON(e)}return i.success(e,t)},complete:function(e,t){i.ajaxing=false;if(t=="error"||t=="parsererror"){return i.error(e,i.url)}},dataType:"json",type:"POST"};$(i.element).bind(n.event,function(e){return i.eventResponse(this,e)});if(n.keypress){$(i.element).keypress(function(e){return i.keypressResponse(this,e)})}if(n.prevent){$(i.element).bind(n.prevent,false)}};Drupal.ajax.prototype.keypressResponse=function(e,t){var n=this;if(t.which==13||t.which==32&&e.type!="text"&&e.type!="textarea"){$(n.element_settings.element).trigger(n.element_settings.event);return false}};Drupal.ajax.prototype.eventResponse=function(e,t){var n=this;if(n.ajaxing){return false}try{if(n.form){if(n.setClick){e.form.clk=e}n.form.ajaxSubmit(n.options)}else{n.beforeSerialize(n.element,n.options);$.ajax(n.options)}}catch(r){n.ajaxing=false;alert("An error occurred while attempting to process "+n.options.url+": "+r.message)}if(typeof e.type!="undefined"&&(e.type=="checkbox"||e.type=="radio")){return true}else{return false}};Drupal.ajax.prototype.beforeSerialize=function(e,t){if(this.form){var n=this.settings||Drupal.settings;Drupal.detachBehaviors(this.form,n,"serialize")}t.data["ajax_html_ids[]"]=[];$("[id]").each(function(){t.data["ajax_html_ids[]"].push(this.id)});t.data["ajax_page_state[theme]"]=Drupal.settings.ajaxPageState.theme;t.data["ajax_page_state[theme_token]"]=Drupal.settings.ajaxPageState.theme_token;for(var r in Drupal.settings.ajaxPageState.css){t.data["ajax_page_state[css]["+r+"]"]=1}for(var r in Drupal.settings.ajaxPageState.js){t.data["ajax_page_state[js]["+r+"]"]=1}};Drupal.ajax.prototype.beforeSubmit=function(e,t,n){};Drupal.ajax.prototype.beforeSend=function(xmlhttprequest,options){if(this.form){options.extraData=options.extraData||{};options.extraData.ajax_iframe_upload="1";var v=$.fieldValue(this.element);if(v!==null){options.extraData[this.element.name]=v}}$(this.element).addClass("progress-disabled").attr("disabled",true);if(this.progress.type=="bar"){var progressBar=new Drupal.progressBar("ajax-progress-"+this.element.id,eval(this.progress.update_callback),this.progress.method,eval(this.progress.error_callback));if(this.progress.message){progressBar.setProgress(-1,this.progress.message)}if(this.progress.url){progressBar.startMonitoring(this.progress.url,this.progress.interval||1500)}this.progress.element=$(progressBar.element).addClass("ajax-progress ajax-progress-bar");this.progress.object=progressBar;$(this.element).after(this.progress.element)}else if(this.progress.type=="throbber"){this.progress.element=$('<div class="ajax-progress ajax-progress-throbber"><div class="throbber">&nbsp;</div></div>');if(this.progress.message){$(".throbber",this.progress.element).after('<div class="message">'+this.progress.message+"</div>")}$(this.element).after(this.progress.element)}};Drupal.ajax.prototype.success=function(e,t){if(this.progress.element){$(this.progress.element).remove()}if(this.progress.object){this.progress.object.stopMonitoring()}$(this.element).removeClass("progress-disabled").removeAttr("disabled");Drupal.freezeHeight();for(var n in e){if(e.hasOwnProperty(n)&&e[n]["command"]&&this.commands[e[n]["command"]]){this.commands[e[n]["command"]](this,e[n],t)}}if(this.form){var r=this.settings||Drupal.settings;Drupal.attachBehaviors(this.form,r)}Drupal.unfreezeHeight();this.settings=null};Drupal.ajax.prototype.getEffect=function(e){var t=e.effect||this.effect;var n=e.speed||this.speed;var r={};if(t=="none"){r.showEffect="show";r.hideEffect="hide";r.showSpeed=""}else if(t=="fade"){r.showEffect="fadeIn";r.hideEffect="fadeOut";r.showSpeed=n}else{r.showEffect=t+"Toggle";r.hideEffect=t+"Toggle";r.showSpeed=n}return r};Drupal.ajax.prototype.error=function(e,t){alert(Drupal.ajaxError(e,t));if(this.progress.element){$(this.progress.element).remove()}if(this.progress.object){this.progress.object.stopMonitoring()}$(this.wrapper).show();$(this.element).removeClass("progress-disabled").removeAttr("disabled");if(this.form){var n=e.settings||this.settings||Drupal.settings;Drupal.attachBehaviors(this.form,n)}};Drupal.ajax.prototype.commands={insert:function(e,t,n){var r=t.selector?$(t.selector):$(e.wrapper);var i=t.method||e.method;var s=e.getEffect(t);var o=$("<div></div>").html(t.data);var u=o.contents();if(u.length!=1||u.get(0).nodeType!=1){u=o}switch(i){case"html":case"replaceWith":case"replaceAll":case"empty":case"remove":var a=t.settings||e.settings||Drupal.settings;Drupal.detachBehaviors(r,a)}r[i](u);if(s.showEffect!="show"){u.hide()}if($(".ajax-new-content",u).length>0){$(".ajax-new-content",u).hide();u.show();$(".ajax-new-content",u)[s.showEffect](s.showSpeed)}else if(s.showEffect!="show"){u[s.showEffect](s.showSpeed)}if(u.parents("html").length>0){var a=t.settings||e.settings||Drupal.settings;Drupal.attachBehaviors(u,a)}},remove:function(e,t,n){var r=t.settings||e.settings||Drupal.settings;Drupal.detachBehaviors($(t.selector),r);$(t.selector).remove()},changed:function(e,t,n){if(!$(t.selector).hasClass("ajax-changed")){$(t.selector).addClass("ajax-changed");if(t.asterisk){$(t.selector).find(t.asterisk).append(' <span class="ajax-changed">*</span> ')}}},alert:function(e,t,n){alert(t.text,t.title)},css:function(e,t,n){$(t.selector).css(t.argument)},settings:function(e,t,n){if(t.merge){$.extend(true,Drupal.settings,t.settings)}else{e.settings=t.settings}},data:function(e,t,n){$(t.selector).data(t.name,t.value)},invoke:function(e,t,n){var r=$(t.selector);r[t.method].apply(r,t.arguments)},restripe:function(e,t,n){$("> tbody > tr:visible, > tr:visible",$(t.selector)).removeClass("odd even").filter(":even").addClass("odd").end().filter(":odd").addClass("even")},updateBuildId:function(e,t,n){$('input[name="form_build_id"][value="'+t["old"]+'"]').val(t["new"])}}})(jQuery)